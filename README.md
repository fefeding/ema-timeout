
EMA算法本身是多用于金融行业的，是一种基于增加期望的模型。算法的主要思想是综合利用历史上积累到的数据，预测下一个周期内的期望。我们参考了标准的EMA算法，得到了符合互联网业务特点的用于超时控制的EMA算法。具体的思想主要是引入“平均效应”的概念，用平均响应时间代替固定超时时间，只要平均响应时间没有超时即可，而不是要求每次都不能超时。主要几点：总体情况不能超标；平均情况表现越好，弹性越大；平均情况表现越差，弹性越小。这里的弹性指的是允许毛刺情况的最大响应时间。

参数：

响应时间下限：Tavg

超时时间限制：Thwm

最大弹性时间：Tmax

EMA平滑指数：N

结果：

动态超时时间：Tdto

平均响应时间：EMA



EMA这个算法的适用条件：

固定业务逻辑，循环执行，如FastCGI/S++。

程序大部分时间在等待响应，而不是CPU计算或处理I/O中断。

服务是串行处理模式，容易受异常、慢请求阻塞。

响应时间不宜波动过大。

可以接受有损服务。